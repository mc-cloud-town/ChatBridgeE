name: build

on:
  workflow_dispatch:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: build
        run: |
          cd chatbridgee

          zip -r chatbridgee * || echo "build to zip error"
          mv chatbridgee.zip chatbridgee.mcdr
          cp chatbridgee.mcdr ..

          cd ../server
          zip -r server server/* || echo "build to zip error"
          cp server.pyz ..
          cd ..
          mv server.py __main__.py
          zip -f server __main__.py
          mv server.zip server.pyz

          cd plugins
          zip -r plugins * || echo "build to zip error"
          cp plugins.zip ..

      - name: upload Release
        uses: ncipollo/release-action@v1
        with:
          allowUpdates: true
          token: ${{ secrets.GITHUB_TOKEN }}
          tag: latest
          artifacts: '*.mcdr,*.pyz,*.zip'
