name: build

on:
  workflow_dispatch:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: build
        run: |
          cd chatbridgee

          zip -r chatbridgee * || echo "build to zip error"
          mv chatbridgee.zip chatbridgee.mcdr
          cp chatbridgee.mcdr ..

          cd ..
          mkdir -p tmp/server && cp -R server tmp
          cp server.py tmp/__main__.py
          cd tmp && zip -r server.pyz * && cp server.pyz .. && cd ..

          cd plugins
          zip -r plugins * || echo "build to zip e rror"
          cp plugins.zip ..

      - name: upload Release
        uses: ncipollo/release-action@v1
        with:
          allowUpdates: true
          token: ${{ secrets.GITHUB_TOKEN }}
          tag: latest
          artifacts: '*.mcdr,*.pyz,*.zip'
